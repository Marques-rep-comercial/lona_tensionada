<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Lona Tensionada Iluminada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .result-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
        }
        .result-card .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1d4ed8; /* blue-700 */
        }
        .result-card .detail {
            font-size: 0.8rem;
            color: #6b7280; /* gray-500 */
        }
        #downloadPdfBtn {
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 md:p-8">

        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Calculadora de Lona Tensionada</h1>
            <p class="text-gray-500 mt-2">Selecione a forma e insira as dimensões.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Input Section -->
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-700 mb-2 border-b pb-3">Dimensões e Forma</h2>
                <p class="text-red-600 text-sm font-semibold my-4">*Atenção para respeitar as seguintes medidas de altura das lonas (1.80m, 2.80m e 5.80m) todas com 100 metros lineares.</p>

                <!-- Shape Selector -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-600 mb-2">Tipo de Forma</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="flex items-center">
                            <input type="radio" name="shape" value="rectangle" class="form-radio h-4 w-4 text-blue-600" checked>
                            <span class="ml-2 text-gray-700">Retângulo ou Quadrado</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="shape" value="circle" class="form-radio h-4 w-4 text-blue-600">
                            <span class="ml-2 text-gray-700">Círculo</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="shape" value="ellipse" class="form-radio h-4 w-4 text-blue-600">
                            <span class="ml-2 text-gray-700">Elipse (Oval)</span>
                        </label>
                         <label class="flex items-center">
                            <input type="radio" name="shape" value="custom" class="form-radio h-4 w-4 text-blue-600">
                            <span class="ml-2 text-gray-700">Polígono Irregular</span>
                        </label>
                    </div>
                </div>

                <!-- Profile Selector -->
                <div class="mb-4">
                    <label for="profileType" class="block text-sm font-medium text-gray-600 mb-1">Tipo de Perfil</label>
                    <select id="profileType" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="2.5" data-name='Perfil "H"'>Perfil "H" (barras de 2.5m)</option>
                        <option value="2" data-name='Perfil "H" Flexível'>Perfil "H" Flexível (barras de 2m)</option>
                        <option value="3" data-name='Perfil "E" Sobrepor'>Perfil "E" Sobrepor (barras de 3m)</option>
                    </select>
                </div>
                
                <!-- Inputs for dimensions -->
                <div id="dimensionsInputs" class="space-y-4">
                    <!-- Rectangle Inputs -->
                    <div id="rectangleInputs">
                        <div>
                            <label for="comprimento" class="block text-sm font-medium text-gray-600 mb-1">Comprimento (metros)</label>
                            <input type="number" id="comprimento" value="2.5" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="altura" class="block text-sm font-medium text-gray-600 mb-1">Altura (metros)</label>
                            <input type="number" id="altura" value="1.5" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <!-- Circle Input (hidden by default) -->
                    <div id="circleInputs" class="hidden">
                        <div>
                            <label for="diametro" class="block text-sm font-medium text-gray-600 mb-1">Diâmetro (metros)</label>
                            <input type="number" id="diametro" value="2.0" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                     <!-- Ellipse Inputs (hidden by default) -->
                    <div id="ellipseInputs" class="hidden">
                        <div>
                            <label for="eixoMaior" class="block text-sm font-medium text-gray-600 mb-1">Eixo Maior (metros)</label>
                            <input type="number" id="eixoMaior" value="3.0" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="eixoMenor" class="block text-sm font-medium text-gray-600 mb-1">Eixo Menor (metros)</label>
                            <input type="number" id="eixoMenor" value="2.0" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <!-- Custom Shape Inputs (hidden by default) -->
                    <div id="customInputs" class="hidden space-y-4">
                        <div id="customSidesContainer" class="space-y-2">
                             <!-- Dynamic side inputs will be added here -->
                        </div>
                        <button id="addSideBtn" type="button" class="w-full text-sm bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">Adicionar Medida</button>
                        <div>
                            <label for="customArea" class="block text-sm font-medium text-gray-600 mb-1">Área (m²)</label>
                            <input type="number" id="customArea" value="5.0" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Necessário para cálculo de LED">
                        </div>
                    </div>
                </div>

                <!-- Advanced Settings -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Configurações Avançadas</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="potenciaFita" class="block text-sm font-medium text-gray-600 mb-1">Potência da Fita (W/m)</label>
                            <input type="number" id="potenciaFita" value="6" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="espacamentoFita" class="block text-sm font-medium text-gray-600 mb-1">Espaçamento entre Fitas (m)</label>
                            <input type="number" id="espacamentoFita" value="0.07" step="0.01" class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Output Section -->
            <div class="bg-blue-50 p-6 rounded-lg border border-blue-200 flex flex-col">
                <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">Quantitativos de Materiais</h2>
                <div id="results" class="grid grid-cols-2 sm:grid-cols-2 gap-4">
                    <!-- Results will be injected here -->
                </div>
                 <div class="mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-center">
                    <h3 class="font-bold text-green-800">Fonte de Alimentação</h3>
                    <div id="fonteResult" class="result-card text-center">
                         <!-- Fonte result will be injected here -->
                    </div>
                </div>
                <div class="mt-auto pt-6">
                     <button id="downloadPdfBtn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-md hover:bg-green-700 transition-colors">
                        Baixar Quantitativos (PDF)
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="text-center mt-8 pt-6 border-t border-gray-200">
            <p class="text-sm text-gray-600 font-semibold">REPRESENTANTE COMERCIAL</p>
            <p class="text-sm text-gray-500">Marcio Marques - (81) 9.9464-5392</p>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        // --- DOM Element References ---
        const comprimentoInput = document.getElementById('comprimento');
        const alturaInput = document.getElementById('altura');
        const diametroInput = document.getElementById('diametro');
        const eixoMaiorInput = document.getElementById('eixoMaior');
        const eixoMenorInput = document.getElementById('eixoMenor');
        const customAreaInput = document.getElementById('customArea');
        const customSidesContainer = document.getElementById('customSidesContainer');
        const addSideBtn = document.getElementById('addSideBtn');
        const potenciaFitaInput = document.getElementById('potenciaFita');
        const espacamentoFitaInput = document.getElementById('espacamentoFita');
        const resultsDiv = document.getElementById('results');
        const fonteResultDiv = document.getElementById('fonteResult');
        const shapeRadios = document.querySelectorAll('input[name="shape"]');
        const profileTypeSelect = document.getElementById('profileType');
        const rectangleInputsDiv = document.getElementById('rectangleInputs');
        const circleInputsDiv = document.getElementById('circleInputs');
        const ellipseInputsDiv = document.getElementById('ellipseInputs');
        const customInputsDiv = document.getElementById('customInputs');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');

        let lastCalculatedResults = {};

        /**
         * Toggles input visibility based on selected shape.
         */
        function handleShapeChange() {
            const selectedShape = document.querySelector('input[name="shape"]:checked').value;
            rectangleInputsDiv.classList.add('hidden');
            circleInputsDiv.classList.add('hidden');
            ellipseInputsDiv.classList.add('hidden');
            customInputsDiv.classList.add('hidden');

            if (selectedShape === 'rectangle') {
                rectangleInputsDiv.classList.remove('hidden');
            } else if (selectedShape === 'circle') {
                circleInputsDiv.classList.remove('hidden');
            } else if (selectedShape === 'ellipse') {
                ellipseInputsDiv.classList.remove('hidden');
            } else if (selectedShape === 'custom') {
                customInputsDiv.classList.remove('hidden');
                if (customSidesContainer.children.length === 0) {
                    addSideInput();
                    addSideInput();
                    addSideInput();
                }
            }
            calculateMaterials();
        }

        /**
         * Re-labels the side inputs sequentially after a removal.
         */
        function relabelCustomSides() {
            const sideDivs = customSidesContainer.children;
            for (let i = 0; i < sideDivs.length; i++) {
                const label = sideDivs[i].querySelector('label');
                if (label) {
                    label.textContent = `Lado ${i + 1} (metros)`;
                }
            }
        }

        /**
         * Adds a new input field for a side of the custom shape.
         */
        function addSideInput() {
            const sideCount = customSidesContainer.children.length + 1;
            const newSideDiv = document.createElement('div');
            newSideDiv.className = 'flex items-center gap-2';
            newSideDiv.innerHTML = `
                <label for="side${sideCount}" class="block text-sm font-medium text-gray-700 mb-1 flex-grow">Lado ${sideCount} (metros)</label>
                <input type="number" class="w-full p-2 bg-white border border-gray-300 rounded-md shadow-sm custom-side-input" value="1.0">
                <button type="button" class="remove-side-btn bg-red-500 text-white font-bold w-8 h-8 rounded-md hover:bg-red-600 transition-colors flex items-center justify-center">-</button>
            `;
            customSidesContainer.appendChild(newSideDiv);
            
            newSideDiv.querySelector('input').addEventListener('input', calculateMaterials);
            
            newSideDiv.querySelector('.remove-side-btn').addEventListener('click', () => {
                newSideDiv.remove();
                relabelCustomSides();
                calculateMaterials();
            });
        }

        /**
         * Calculates all material quantities based on user inputs.
         */
        function calculateMaterials() {
            const selectedShape = document.querySelector('input[name="shape"]:checked').value;
            const potenciaFita = parseFloat(potenciaFitaInput.value) || 0;
            const espacamentoFita = parseFloat(espacamentoFitaInput.value) || 0.07;
            
            const selectedProfileOption = profileTypeSelect.options[profileTypeSelect.selectedIndex];
            const profileBarLength = parseFloat(selectedProfileOption.value) || 2.5;
            const profileName = selectedProfileOption.getAttribute('data-name');
            const profileUnit = `barras de ${profileBarLength.toString().replace('.',',')}m`;

            let perimetro = 0;
            let area = 0;
            let lonaLinearDimension = 0;
            let dimensionsText = '';
            let shapeLabel = '';
            const rawDimensions = {};

            if (selectedShape === 'rectangle') {
                const comprimento = parseFloat(comprimentoInput.value) || 0;
                const altura = parseFloat(alturaInput.value) || 0;
                rawDimensions.comprimento = comprimento;
                rawDimensions.altura = altura;
                perimetro = (comprimento + altura) * 2;
                area = comprimento * altura;
                lonaLinearDimension = comprimento;
                dimensionsText = `Comprimento: ${comprimento}m, Altura: ${altura}m`;
                shapeLabel = comprimento === altura ? 'Quadrado' : 'Retângulo';
            } else if (selectedShape === 'circle') {
                const diametro = parseFloat(diametroInput.value) || 0;
                rawDimensions.diametro = diametro;
                perimetro = Math.PI * diametro;
                area = Math.PI * Math.pow(diametro / 2, 2);
                lonaLinearDimension = diametro;
                dimensionsText = `Diâmetro: ${diametro}m`;
                shapeLabel = 'Círculo';
            } else if (selectedShape === 'ellipse') {
                const eixoMaior = parseFloat(eixoMaiorInput.value) || 0;
                const eixoMenor = parseFloat(eixoMenorInput.value) || 0;
                rawDimensions.eixoMaior = eixoMaior;
                rawDimensions.eixoMenor = eixoMenor;
                const a = eixoMaior / 2;
                const b = eixoMenor / 2;
                perimetro = Math.PI * (3 * (a + b) - Math.sqrt((3 * a + b) * (a + 3 * b)));
                area = Math.PI * a * b;
                lonaLinearDimension = eixoMaior;
                dimensionsText = `Eixo Maior: ${eixoMaior}m, Eixo Menor: ${eixoMenor}m`;
                shapeLabel = 'Elipse';
            } else if (selectedShape === 'custom') {
                const sideInputs = document.querySelectorAll('.custom-side-input');
                const sides = Array.from(sideInputs).map(input => parseFloat(input.value) || 0);
                rawDimensions.sides = sides;
                rawDimensions.area = parseFloat(customAreaInput.value) || 0;
                perimetro = sides.reduce((sum, side) => sum + side, 0);
                area = rawDimensions.area;
                lonaLinearDimension = Math.max(...sides, 0);
                dimensionsText = `Lados: ${sides.join('m, ')}m. Área: ${area}m²`;
                shapeLabel = 'Polígono Irregular';
            }

            const siliconePerimetro = perimetro;
            const perfilQuantidade = perimetro / profileBarLength;
            const metragemFita = espacamentoFita > 0 ? area / espacamentoFita : 0;
            const fitaLedRolos = metragemFita / 3;
            const fontePotencia = metragemFita * potenciaFita;

            const resultsData = [
                { title: 'Lona', unit: 'metros linear', value: lonaLinearDimension },
                { title: 'Silicone', unit: 'metros', value: siliconePerimetro },
                { title: profileName, unit: profileUnit, value: perfilQuantidade },
                { title: 'Fita de LED', unit: 'rolos de 3m', value: fitaLedRolos },
            ];
            
            lastCalculatedResults = {
                shape: shapeLabel,
                dimensions: dimensionsText,
                rawDimensions: rawDimensions,
                profile: `${profileName} (${profileUnit})`,
                materials: resultsData,
                power: { value: fontePotencia, rounded: Math.ceil(fontePotencia) }
            };

            resultsDiv.innerHTML = '';
            resultsData.forEach(item => {
                const roundedValue = Math.ceil(item.value);
                const resultCard = `
                    <div class="result-card bg-white p-4 rounded-lg shadow-sm text-center border">
                        <h3>${item.title}</h3>
                        <p class="value">${roundedValue}</p>
                        <p class="detail">${item.unit}</p>
                        <p class="detail">(${item.value.toFixed(2)} exato)</p>
                    </div>`;
                resultsDiv.innerHTML += resultCard;
            });

            fonteResultDiv.innerHTML = `
                <p class="value">${lastCalculatedResults.power.rounded} W</p>
                <p class="detail">Potência Mínima Recomendada</p>
                <p class="detail">(${lastCalculatedResults.power.value.toFixed(2)} W exato)</p>`;
        }

        /**
         * Generates and downloads a PDF with the calculated quantities.
         */
        function downloadPDF() {
            const doc = new jsPDF();
            const data = lastCalculatedResults;
            const today = new Date().toLocaleDateString('pt-BR');

            doc.setFontSize(18);
            doc.text("Orçamento de Materiais - Lona Tensionada", 14, 22);
            doc.setFontSize(11);
            doc.setTextColor(100);
            doc.text(`Data: ${today}`, 14, 29);

            doc.setFontSize(12);
            doc.setTextColor(0);
            doc.text("Parâmetros do Projeto", 14, 45);
            doc.autoTable({
                startY: 48,
                head: [['Forma', 'Dimensões', 'Tipo de Perfil']],
                body: [[data.shape, data.dimensions, data.profile]],
                theme: 'striped'
            });
            let lastY = doc.autoTable.previous.finalY;

            if (data.shape !== 'Polígono Irregular') {
                doc.setFontSize(12);
                doc.setTextColor(0);
                doc.text(`Desenho Representativo - ${data.shape}`, 14, lastY + 15);
                const drawStartY = lastY + 20;
                const drawAreaWidth = doc.internal.pageSize.width - 28;
                const drawCenterX = 14 + drawAreaWidth / 2;
                const drawMaxHeight = 50;
                let scale, w, h, x, y;

                doc.setLineWidth(0.2);
                doc.setDrawColor(50);
                doc.setFontSize(8);
                doc.setTextColor(80);

                if (data.shape === 'Retângulo' || data.shape === 'Quadrado') {
                    const rawW = data.rawDimensions.comprimento;
                    const rawH = data.rawDimensions.altura;
                    if (rawW > 0 && rawH > 0) {
                        scale = Math.min((drawAreaWidth / rawW) * 0.8, (drawMaxHeight / rawH) * 0.8);
                        w = rawW * scale;
                        h = rawH * scale;
                        x = drawCenterX - w / 2;
                        y = drawStartY;
                        doc.rect(x, y, w, h);
                        doc.line(x, y + h + 5, x + w, y + h + 5);
                        doc.line(x, y + h + 3, x, y + h + 7);
                        doc.line(x + w, y + h + 3, x + w, y + h + 7);
                        doc.text(`${rawW}m`, x + w / 2, y + h + 9, { align: 'center' });
                        doc.line(x - 5, y, x - 5, y + h);
                        doc.line(x - 7, y, x - 3, y);
                        doc.line(x - 7, y + h, x - 3, y + h);
                        doc.text(`${rawH}m`, x - 7, y + h / 2, { align: 'right', baseline: 'middle' });
                    }
                } else if (data.shape === 'Círculo') {
                    const rawD = data.rawDimensions.diametro;
                    if (rawD > 0) {
                        const r = (rawD / 2) * (Math.min(drawAreaWidth, drawMaxHeight) / rawD * 0.8);
                        x = drawCenterX;
                        y = drawStartY + r;
                        doc.circle(x, y, r);
                        doc.line(x - r, y, x + r, y);
                        doc.line(x - r, y - 2, x - r, y + 2);
                        doc.line(x + r, y - 2, x + r, y + 2);
                        doc.text(`${rawD}m`, x, y + 6, { align: 'center' });
                    }
                } else if (data.shape === 'Elipse') {
                    const rawW = data.rawDimensions.eixoMaior;
                    const rawH = data.rawDimensions.eixoMenor;
                    if (rawW > 0 && rawH > 0) {
                        scale = Math.min((drawAreaWidth / rawW) * 0.8, (drawMaxHeight / rawH) * 0.8);
                        const rx = (rawW / 2) * scale;
                        const ry = (rawH / 2) * scale;
                        x = drawCenterX;
                        y = drawStartY + ry;
                        doc.ellipse(x, y, rx, ry);
                        doc.line(x - rx, y, x + rx, y);
                        doc.text(`${rawW}m`, x, y + 4, { align: 'center' });
                        doc.line(x, y - ry, x, y + ry);
                        doc.text(`${rawH}m`, x + 4, y, { align: 'left', baseline: 'middle' });
                    }
                }
                lastY = drawStartY + drawMaxHeight + 10;
            } else {
                lastY += 5;
            }
            
            const tableBody = data.materials.map(item => [
                item.title,
                Math.ceil(item.value),
                item.unit,
                item.value.toFixed(2)
            ]);
            
            doc.setFontSize(12);
            doc.setTextColor(0);
            doc.text("Quantitativos de Materiais", 14, lastY);
            doc.autoTable({
                startY: lastY + 3,
                head: [['Material', 'Qtd. (Arred.)', 'Unidade', 'Valor Exato']],
                body: tableBody,
                theme: 'grid'
            });
            lastY = doc.autoTable.previous.finalY;

            doc.text("Fonte de Alimentação Recomendada", 14, lastY + 10);
            doc.autoTable({
                startY: lastY + 13,
                body: [
                    [`Potência Mínima: ${data.power.rounded} W (Valor exato: ${data.power.value.toFixed(2)} W)`]
                ]
            });

            const pageHeight = doc.internal.pageSize.height || doc.internal.pageSize.getHeight();
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text("REPRESENTANTE COMERCIAL: Marcio Marques - (81) 9.9464-5392", 14, pageHeight - 10);

            doc.save(`orcamento-lona-${new Date().getTime()}.pdf`);
        }
        
        // --- Event Listeners ---
        const allInputs = [comprimentoInput, alturaInput, diametroInput, eixoMaiorInput, eixoMenorInput, customAreaInput, potenciaFitaInput, espacamentoFitaInput, profileTypeSelect];
        allInputs.forEach(input => input.addEventListener('input', calculateMaterials));
        shapeRadios.forEach(radio => radio.addEventListener('change', handleShapeChange));
        downloadPdfBtn.addEventListener('click', downloadPDF);
        addSideBtn.addEventListener('click', addSideInput);

        // --- Initial Setup ---
        window.addEventListener('load', () => {
            handleShapeChange();
        });

    </script>

</body>
</html>
